<div class="person-form-page">
  <div class="container">
    <!-- Header -->
    <header class="page-header">
      <h1>üìã Formulario Avanzado de Persona</h1>
      <p class="subtitle">
        Demostraci√≥n de <strong>ControlValueAccessor</strong>, <strong>FormArray</strong> y <strong>carga desde JSON</strong>
      </p>
    </header>

    <!-- Botones de acci√≥n superior -->
    <div class="action-buttons">
      <button 
        type="button" 
        class="btn btn-secondary"
        (click)="loadMockData()"
      >
        üì• Cargar Datos de Ejemplo
      </button>
      
      <button 
        type="button" 
        class="btn btn-secondary"
        (click)="clearForm()"
      >
        üóëÔ∏è Limpiar Formulario
      </button>

      <button 
        type="button" 
        class="btn btn-info"
        (click)="exportAsJson()"
      >
        üíæ Exportar JSON
      </button>
    </div>

    <!-- Formulario Principal -->
    <form [formGroup]="personForm" (ngSubmit)="onSubmit()" class="main-form">
      
      <!-- Secci√≥n 1: Informaci√≥n B√°sica -->
      <section class="form-section">
        <!--
          BasicInfoFieldset es un CVA personalizado
          Se usa con formControlName y maneja internamente su propio FormGroup
        -->
        <app-basic-info-fieldset formControlName="basicInfo"></app-basic-info-fieldset>
      </section>

      <!-- Secci√≥n 2: Direcciones -->
      <section class="form-section">
        <!--
          AddressList es un CVA que gestiona un FormArray
          Internamente usa AddressForm (otro CVA) para cada direcci√≥n
          Este es el patr√≥n CVA + FormArray en acci√≥n
        -->
        <app-address-list formControlName="addresses"></app-address-list>
      </section>

      <!-- Informaci√≥n del estado del formulario -->
      <div class="form-status">
        <div class="status-item" [class.valid]="isFormValid" [class.invalid]="!isFormValid">
          <span class="status-label">Estado:</span>
          <span class="status-value">
            {{ isFormValid ? '‚úÖ V√°lido' : '‚ùå Inv√°lido' }}
          </span>
        </div>
        
        <div class="status-item">
          <span class="status-label">Direcciones:</span>
          <span class="status-value">
            {{ (personForm.get('addresses')?.value?.length || 0) }}
          </span>
        </div>
      </div>

      <!-- Bot√≥n Submit -->
      <div class="submit-section">
        <button 
          type="submit" 
          class="btn btn-primary btn-large"
        >
          üöÄ Enviar Formulario
        </button>
        
        <p class="help-text">
          Los datos se mostrar√°n en la consola del navegador
        </p>
      </div>
    </form>

    <!-- Modal/Panel para mostrar el JSON -->
    @if (showFormValue) {
      <div class="json-overlay" (click)="closeJsonView()">
        <div class="json-panel" (click)="$event.stopPropagation()">
          <div class="json-header">
            <h3>üìÑ Datos del Formulario (JSON)</h3>
            <button 
              type="button" 
              class="btn-close"
              (click)="closeJsonView()"
            >
              ‚úï
            </button>
          </div>
          <pre class="json-content">{{ formJsonValue }}</pre>
          <div class="json-footer">
            <button 
              type="button" 
              class="btn btn-secondary"
              (click)="closeJsonView()"
            >
              Cerrar
            </button>
          </div>
        </div>
      </div>
    }

    <!-- Informaci√≥n educativa -->
    <footer class="page-footer">
      <div class="info-box">
        <h3>üí° Conceptos demostrados</h3>
        <ul>
          <li>
            <strong>ControlValueAccessor (CVA):</strong> 
            BasicInfoFieldset, AddressForm y AddressList son componentes CVA personalizados
          </li>
          <li>
            <strong>FormArray Din√°mico:</strong> 
            A√±ade/elimina direcciones din√°micamente con validaci√≥n
          </li>
          <li>
            <strong>Carga desde JSON:</strong> 
            Usa "Cargar Datos de Ejemplo" para ver c√≥mo se inicializa desde JSON
          </li>
          <li>
            <strong>Validaci√≥n:</strong> 
            Los CVA propagan validaciones al formulario padre
          </li>
          <li>
            <strong>Composici√≥n:</strong> 
            AddressList usa AddressForm (CVA dentro de CVA)
          </li>
        </ul>
      </div>
    </footer>
  </div>
</div>

